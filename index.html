<!DOCTYPE html>
<html>
<head>
  <title>CBPAI Student Live Data</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
      background: #f4f6f8;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      background: white;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
    }
    th {
      background: #2c3e50;
      color: white;
    }
    tr:nth-child(even) {
      background: #f2f2f2;
    }

    #stateCount, #cbpaiCount {
  background: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0px 2px 5px rgba(0,0,0,0.1);
  width: 300px;
}

  </style>
</head>
<body>

<h2>ðŸ“Š Live CBPAI Student Responses</h2>
<h3>ðŸ“Š Analytics Dashboard</h3>

<canvas id="stateChart" width="400" height="200"></canvas>
<br><br>
<canvas id="cbpaiChart" width="400" height="200"></canvas>
<br><br>

<table id="dataTable">
  <thead></thead>
  <tbody></tbody>
</table>

<script>
fetch("https://script.google.com/macros/s/AKfycbyp8WatkRdlf6rkk42ZP4a99pV6BUkAg0wpRQ6mtsJGVTFlaCv3KbfX39ldsSZBuvUB/exec")
  .then(response => response.json())
  .then(data => {

    // ================= TABLE =================
    const tableHead = document.querySelector("#dataTable thead");
    const tableBody = document.querySelector("#dataTable tbody");

    let headers = Object.keys(data[0]);

    let headRow = "<tr>";
    headers.forEach(h => headRow += `<th>${h}</th>`);
    headRow += "</tr>";
    tableHead.innerHTML = headRow;

    data.forEach(row => {
      let tr = "<tr>";
      headers.forEach(h => tr += `<td>${row[h]}</td>`);
      tr += "</tr>";
      tableBody.innerHTML += tr;
    });

    // ================= ANALYTICS =================

    let stateCounts = {};
    let yesCount = 0;
    let noCount = 0;

    data.forEach(row => {
      let state = row["State"];
      stateCounts[state] = (stateCounts[state] || 0) + 1;

      let cbpai = row["Completed CBPAI Basics"];
      if (cbpai.toLowerCase() === "yes") yesCount++;
      else noCount++;
    });

    // ================= STATE BAR CHART =================
    const stateLabels = Object.keys(stateCounts);
    const stateValues = Object.values(stateCounts);

    new Chart(document.getElementById("stateChart"), {
      type: "bar",
      data: {
        labels: stateLabels,
        datasets: [{
          label: "Students per State",
          data: stateValues,
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false }
        }
      }
    });

    // ================= CBPAI PIE CHART =================
    new Chart(document.getElementById("cbpaiChart"), {
      type: "pie",
      data: {
        labels: ["Yes", "No"],
        datasets: [{
          data: [yesCount, noCount],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true
      }
    });

  });
</script>



</body>
</html>
